<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0">
  <title>計算結果</title>
  <link rel="stylesheet" href="styles.css"> <!-- 外部CSSのリンク -->
</head>

<body>
  <div id="resultsContainer">
    <div id="timer">0:00:00</div>
    <h2>記録一覧</h2>
    <ul id="resultsList" style="list-style-type: none;font-size: 18pt;"></ul> <!-- リストの点を消す -->
  </div>

  <div id="totalCostContainer">
    <h3>見込み利益合計: <span id="totalCost">0 円</span></h3>
  </div>


  <!-- 稼働時間合計 -->
  <div id="totalHoursContainer">
    <h3>稼働合計: <span id="totalHours" style="font-size: 18pt;">0 時間 0 分</span></h3>
  </div>

  <!-- ノルマ表示 -->
  <div id="targetContainer">
    <h3>ノルマ: <span id="targetResult" style="font-size: 18pt;">0 時間 0 分</span></h3>
  </div>

  <!-- ローカルストレージをクリアするボタン -->



  <!-- 送信完了メッセージ -->
  <div class="button_Section">
    <div>
      <button id="controlButton" class="control_Button">仕入れ開始</button>
      <button id="toggleTimerButton" class="control_Button">停止</button>
      <button onclick="clearLocalStorage()" class="clear_button">クリア</button> <!-- クリアを同じセクションに -->
    </div>

    <div>
      <a href="https://mizumati802.github.io/auto-calculation-app" class="buck_link">戻る</a>
    </div>
  </div>
  <!-- 戻るリンク -->



  <script>
    let startTime = localStorage.getItem('startTime') ? parseInt(localStorage.getItem('startTime')) : 0;
    let elapsedTime = localStorage.getItem('elapsedTime') ? parseInt(localStorage.getItem('elapsedTime')) : 0;
    let isRunning = localStorage.getItem('isRunning') === 'true';
    let timerInterval = null;

    const timerDisplay = document.getElementById('timer');
    const controlButton = document.getElementById('controlButton');
    const toggleTimerButton = document.getElementById('toggleTimerButton');

    function setButtonStyle(button, running) {
      button.style.color = '#ffffff';
      button.style.backgroundColor = running ? '#1b386e' : '#6e1b1b';
    }

    function updateTimer() {
      const now = Date.now();
      const elapsed = isRunning ? now - startTime + elapsedTime : elapsedTime;
      const seconds = Math.floor((elapsed / 1000) % 60);
      const minutes = Math.floor(elapsed / 60000) % 60;
      const hours = Math.floor(elapsed / 3600000);

      timerDisplay.textContent = `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

      if (hours >= 3) {
        timerDisplay.style.color = 'red';
      } else if (hours >= 2) {
        timerDisplay.style.color = 'orange';
      } else if (hours >= 1) {
        timerDisplay.style.color = 'green';
      } else {
        timerDisplay.style.color = 'black';
      }
    }

    // ページロード時に状態復元
    if (isRunning) {
      startTime = Date.now() - elapsedTime;
      timerInterval = setInterval(updateTimer, 1000);
      controlButton.textContent = '計測リセット';
      setButtonStyle(controlButton, true);
    } else {
      updateTimer();
      setButtonStyle(controlButton, false);
    }

    // 計測開始・リセットのトグル
    controlButton.addEventListener('click', () => {
      if (isRunning) {
        // タイマーをリセット
        clearInterval(timerInterval);
        localStorage.removeItem('startTime');
        localStorage.removeItem('elapsedTime');
        localStorage.setItem('isRunning', 'false');
        elapsedTime = 0;
        isRunning = false;
        timerDisplay.textContent = '0:00:00';
        controlButton.textContent = '計測開始';
      } else {
        // 計測開始
        startTime = Date.now();
        localStorage.setItem('startTime', startTime);
        localStorage.setItem('elapsedTime', elapsedTime);
        localStorage.setItem('isRunning', 'true');
        timerInterval = setInterval(updateTimer, 1000);
        isRunning = true;
        controlButton.textContent = '計測リセット';
      }
      setButtonStyle(controlButton, isRunning);
    });

    // タイマーの停止・再開のトグル
    toggleTimerButton.addEventListener('click', () => {
      if (isRunning) {
        // タイマーを停止
        clearInterval(timerInterval);
        elapsedTime += Date.now() - startTime;
        localStorage.setItem('elapsedTime', elapsedTime);
        localStorage.setItem('isRunning', 'false');
        isRunning = false;
        toggleTimerButton.textContent = '再開';
      } else {
        // タイマーを再開
        startTime = Date.now();
        localStorage.setItem('startTime', startTime);
        localStorage.setItem('isRunning', 'true');
        timerInterval = setInterval(updateTimer, 1000);
        isRunning = true;
        toggleTimerButton.textContent = '停止';
      }
      setButtonStyle(toggleTimerButton, isRunning);
    });

    // ローカルストレージのクリア
    function clearLocalStorage() {
      clearInterval(timerInterval);
      localStorage.clear();
      elapsedTime = 0;
      isRunning = false;
      timerDisplay.textContent = '0:00:00';
      document.getElementById('totalHours').innerText = '0 時間 0 分';
      controlButton.textContent = '計測開始';
      toggleTimerButton.textContent = '再開';
      setButtonStyle(controlButton, false);
      setButtonStyle(toggleTimerButton, false);
    }
  </script>

</body>

</html>